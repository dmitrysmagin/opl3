<!DOCTYPE html>
<html>
<head>
	<title>OPL3</title>
	<script type="text/javascript" src="../dist/opl3.js"></script>
</head>
<body>
    <div class="counter"></div>
    <div>
        <input
            type="file"
            accept=".raw,.dro,.laa,.imf,.rad"
            onchange="loadFileWorklet(this.files)">
    </div>
    <div>
        <button onclick="PlayerStop()">Stop</button>
        <button onclick="PlayerPause()">Pause</button>
        <button onclick="PlayerResume()">Resume</button>
    </div>

    <script type="text/javascript">
        var player = new OPL3.Player({ prebuffer: 3000, sampleRate: 48000 });

        function FileToArrayBuffer(file /*: File*/) {
            const fileReader = new FileReader();

            return new Promise((resolve, reject) => {
                fileReader.onerror = () => {
                    fileReader.abort();
                    reject(new Error('Problem parsing input file'))
                };

                fileReader.onload = () => {
                    resolve(fileReader.result);
                };

                fileReader.readAsArrayBuffer(file);
            });
        }

        async function loadFileWorklet(files /*: FileList*/) {
            if (files instanceof FileList && files.length) {
                var file = files[0];
                var data /*ArrayBuffer*/ = await FileToArrayBuffer(file);

                player.play(data);
            }
        }
    
        function PlayerPause() {
            player.pause();
        }

        function PlayerResume() {
            player.resume();
        }

        function PlayerStop() {
            player.stop();
        }

	</script>
</body>
</html>
