<!DOCTYPE html>
<html>
<head>
	<title>OPL3</title>
	<script id="opl3" type="text/javascript" src="../dist/opl3.js"></script>
</head>
<body>
    <div class="counter"></div>
    <div>
        <input
            type="file"
            accept=".raw,.dro,.laa,.imf,.rad"
            onchange="loadFileWorklet(this.files)">
    </div>
    <div>
        <button onclick="">Stop</button>
        <button onclick="">Pause</button>
        <button onclick="">Resume</button>
    </div>
    <div style="margin-top: 20px">
        <button onclick="TestWorklet()">Test Worklet</button>
        <button onclick="StopWorklet()">Stop Worklet</button>
        <input type="file" accept=".raw,.dro,.laa,.mus,.imf,.rad" onchange="loadFileWorklet(this.files)">
    </div>

    <script type="text/javascript">
        var mainPlayer = new OPL3.MainPlayer();

        function TestWorklet() {
            mainPlayer = new OPL3.MainPlayer();
        }
    
        function StopWorklet() {
            //worklet && worklet.disconnect();
        }

        function FileToArrayBuffer(file /*: File*/) {
            const fileReader = new FileReader();

            return new Promise((resolve, reject) => {
                fileReader.onerror = () => {
                    fileReader.abort();
                    reject(new Error('Problem parsing input file'))
                };

                fileReader.onload = () => {
                    resolve(fileReader.result);
                };

                fileReader.readAsArrayBuffer(file);
            });
        }

        async function loadFileWorklet(files /*: FileList*/) {
            if (files instanceof FileList && files.length) {
                var file = files[0];
                var data /*ArrayBuffer*/ = await FileToArrayBuffer(file);

                mainPlayer && mainPlayer.load(data) && mainPlayer.play();
            }
        }

        function PlayerStop() {
        }

	</script>
</body>
</html>
